# 발주 관리 - 화면 정의서

## 1. 화면 개요

### 1.1 기본 정보
- **화면명**: 발주 관리
- **목적**: 발주 목록 조회, 발주 등록, 발주 상세 확인

---

## 2. 탭 구조

### 2.1 탭 구성
**2개의 탭으로 구성:**
- 발주 목록 (기본)
- 발주 등록

**탭 전환:**
- 탭 클릭 시 해당 컨텐츠 표시
- 이전 탭 숨김
- 활성 탭 스타일 변경

---

# 탭 1: 발주 목록

## 3. 초기 로드

### 3.1 초기 데이터 로드
- 전체 발주 목록 조회
- 최신순 정렬
- 페이징: 50건씩

### 3.2 초기 화면 상태
- 상태 필터: "상태 전체" 선택
- 견적 필터: "견적 전체" 선택
- 검색어: 비어있음
- 요약 영역: 통계 표시

---

## 4. 검색/필터 영역

### 4.1 상태 필터
**필터 옵션:**
- 상태 전체 (기본값)
- 출고대기
- 출고완료

**동작:**
- 드롭다운 선택 시 즉시 필터 적용

---

### 4.2 견적 필터
**필터 옵션:**
- 견적 전체 (기본값)
- 등록된 견적 목록

**동작:**
- 특정 견적 선택 시 해당 견적의 발주만 표시

---

### 4.3 검색 기능
**검색 대상:**
- 발주 번호
- 견적명
- 통합 검색 (OR 조건)

**[검색] 버튼 클릭 시:**
- 검색 실행
- 결과 테이블 업데이트

---

### 4.4 초기화 기능
**[초기화] 버튼 클릭 시:**
- 모든 필터 "전체"로 리셋
- 검색 입력 필드 초기화
- 전체 목록 재조회

---

## 5. 요약 영역

### 5.1 통계 표시
```
전체: 28건 | 출고대기: 5건 | 출고완료: 23건
```

**특징:**
- 실시간 업데이트 (등록/수정/삭제 시)

---

### 5.2 [+ 새 발주 등록] 버튼
**위치:** 요약 영역 우측

**클릭 시:**
- 발주 등록 탭으로 전환

---

## 6. 목록 테이블

### 6.1 컬럼 구조
| 컬럼명 | 표시 내용 | 비고 |
|--------|----------|------|
| 발주 번호 | IT260115-01 | 굵게 표시 |
| 본사 | 대우건설 | |
| 현장 | 강남 오피스텔 | |
| 견적명 | CCTV 설치 | |
| 발주일 | 2024-01-15 | |
| 자재 | 3종 54개 | |
| 진행률 | 프로그레스바 + 80% | |
| 상태 | 뱃지 (출고대기/출고완료) | |
| 작업 | [상세] 버튼 | |

---

### 6.2 진행률 표시
**표시 방식:**
- 프로그레스 바 + 퍼센트 텍스트

**계산 방식:**
```
진행률 = (출고 완료 수량 / 발주 총 수량) × 100
```

**색상 규칙:**
| 진행률 | 색상 | 의미 |
|--------|------|------|
| 0% | 회색 | 미출고 |
| 1-99% | 주황색 | 출고중 |
| 100% | 초록색 | 완료 |

---

### 6.3 상태 뱃지
**상태별 표시:**
| 상태 | 조건 | 색상 |
|------|------|------|
| 출고대기 | 진행률 < 100% | 주황색 |
| 출고완료 | 진행률 = 100% | 초록색 |

---

### 6.4 행 클릭
**트리거:** 테이블 행 클릭 또는 [상세] 버튼 클릭

**동작:**
- 발주 상세 모달 오픈
- 발주 정보 및 자재 목록 로드

---

## 7. 발주 상세 모달

### 7.1 오픈 조건
- 테이블 행 클릭
- [상세] 버튼 클릭

---

### 7.2 표시 정보

**발주 기본 정보:**
- 발주 번호
- 견적명
- 본사
- 현장
- 발주일
- 납기일
- 상태
- 담당자

**발주 자재 목록 (테이블):**
| 자재 코드 | 자재명 | 발주 수량 | 출고 수량 | 잔여 수량 | 진행률 |
|----------|--------|----------|----------|----------|--------|

**진행 현황:**
- 전체 진행률
- 출고 건 수
- 미출고 자재 수

---

### 7.3 [닫기] 버튼
**동작:**
- 모달 닫기

---

### 7.4 [Excel 다운로드] 버튼 (선택)
**동작:**
- 발주서 Excel 다운로드
- 파일명: 발주서_{발주번호}.xlsx

---

# 탭 2: 발주 등록

## 8. 발주 등록 탭

### 8.1 탭 오픈
**트리거:**
- [발주 등록] 탭 클릭
- 목록의 [+ 새 발주 등록] 버튼 클릭

---

## 9. 견적 선택 영역

### 9.1 견적 검색
**위치:** 상단

**입력 필드:**
- 견적 검색 (Autocomplete)

**검색 동작:**
1. 입력 시 자동완성 드롭다운 표시
2. 견적 목록 표시 (견적번호, 견적명, 본사, 현장)
3. 견적 선택

---

### 9.2 선택된 견적 정보 표시
**선택 시 표시:**
- 견적 번호
- 견적명
- 본사
- 현장
- 견적일
- 견적 금액

---

## 10. 발주 기본 정보 입력

### 10.1 입력 필드

**필수 입력 (*):**
- 견적* (위 검색으로 선택)
- 발주일*
- 납기일*
- 담당자*

**선택 입력:**
- 비고

---

## 11. 발주 자재 목록

### 11.1 자재 목록 테이블

**컬럼:**
| 순서 | 자재 코드 | 자재명 | 규격 | 단가 | 발주 수량 | 금액 | 작업 |
|------|----------|--------|------|------|----------|------|------|

**기능:**
- 드래그 앤 드롭으로 순서 변경 가능
- [X] 버튼으로 자재 삭제
- 수량 직접 수정 가능

---

### 11.2 [+ 자재 추가] 버튼

**동작:**
1. 자재 검색 인라인 입력 표시
2. Autocomplete로 자재 검색
3. 자재 선택 시 테이블에 행 추가
4. 발주 수량 입력 (기본값: 1)

---

### 11.3 자재 Autocomplete

**표시 정보:**
- 자재 코드 (작은 회색 글씨)
- 자재명 (굵게)
- 규격, 재고 정보 (작은 글씨)

**선택 시:**
- 테이블에 자재 행 추가
- 자재 코드, 자재명, 규격, 단가 자동 입력
- 발주 수량 포커스

---

## 12. 발주 요약

### 12.1 표시 정보
```
총 자재 종류: 5종
총 발주 수량: 120개
총 발주 금액: 15,000,000원
```

**자동 계산:**
- 자재 추가/삭제/수량 변경 시 실시간 갱신

---

## 13. [발주 등록] 버튼

### 13.1 유효성 검증

**1단계: 필수 필드 검증**
- 견적 선택 확인
- 발주일 입력 확인
- 납기일 입력 확인
- 담당자 입력 확인

**2단계: 자재 검증**
- 자재 1개 이상 추가 확인
- 모든 자재 수량 1 이상 확인

**3단계: 날짜 검증**
- 납기일 ≥ 발주일 확인

---

### 13.2 동작 순서
1. 필수 필드 검증
2. 자재 검증
3. 날짜 검증
4. 발주 등록 처리
5. 발주 번호 자동 생성
   - 형식: IT + YYMMDD + - + 일련번호
   - 예: IT260211-01
6. 초기 상태: "출고대기"로 설정
7. 성공 알림: "발주가 등록되었습니다"
8. 발주 목록 탭으로 전환
9. 목록 갱신 (새 발주 최상단 추가)

---

### 13.3 [취소] 버튼
**동작:**
- 확인 메시지: "작성 중인 내용이 사라집니다. 취소하시겠습니까?"
- 확인 시: 발주 목록 탭으로 전환
- 취소 시: 현재 탭 유지

---

## 14. 유효성 검증 규칙

### 14.1 발주 등록 필수 필드
- 견적 선택
- 발주일
- 납기일
- 담당자
- 자재 1개 이상

---

### 14.2 날짜 검증
- 납기일 ≥ 발주일
- 위반 시: "납기일은 발주일 이후여야 합니다"

---

### 14.3 자재 수량 검증
- 모든 자재 수량 ≥ 1
- 0 또는 음수 시: "발주 수량은 1 이상이어야 합니다"

---

## 15. 상태 정의

### 15.1 발주 상태

| 상태 | 조건 | 설명 |
|------|------|------|
| 출고대기 | 진행률 < 100% | 출고 진행 중 또는 대기 |
| 출고완료 | 진행률 = 100% | 전량 출고 완료 |

---

### 15.2 진행률 계산
```
진행률 = (출고 완료 수량 / 발주 총 수량) × 100
```

**자동 계산:**
- 출고 등록 시 자동 갱신
- 실시간 반영

---

## 16. 에러 처리

### 16.1 사용자 입력 오류

| 상황 | 메시지 | 동작 |
|------|--------|------|
| 필수 필드 누락 | "필수 항목을 입력해주세요" | 해당 필드 포커스 |
| 자재 미추가 | "발주할 자재를 추가해주세요" | - |
| 수량 0 이하 | "발주 수량은 1 이상이어야 합니다" | 수량 필드 포커스 |
| 납기일 < 발주일 | "납기일은 발주일 이후여야 합니다" | 납기일 필드 포커스 |

---

## 17. 비즈니스 규칙

### 17.1 발주 번호 생성
- 자동 생성 (수동 입력 불가)
- 형식: IT + YYMMDD + - + 일련번호
- 예: IT260211-01
- 일자별 순번 관리

---

### 17.2 진행률 자동 계산
```
진행률 = (출고 완료 수량 / 발주 총 수량) × 100
```

**자동 갱신:**
- 출고 등록 시마다 재계산
- 실시간 반영

---

### 17.3 상태 자동 변경
**진행률 100% 도달 시:**
- 자동으로 "출고완료" 상태로 변경

---

### 17.4 견적 연동
- 발주는 반드시 견적 기반으로 생성
- 견적의 자재 목록을 기본으로 사용
- 견적 금액과 발주 금액 비교 가능

---

## 18. 화면 흐름도

### 18.1 발주 등록 흐름
```
[발주 등록] 탭 클릭
    ↓
견적 검색 (Autocomplete)
    ↓
견적 선택
    ↓
견적 정보 자동 입력
    ↓
발주일/납기일/담당자 입력
    ↓
자재 추가 (Autocomplete)
    ↓
발주 수량 입력
    ↓
(자재 추가 반복)
    ↓
발주 요약 확인
    ↓
[발주 등록] 클릭
    ↓
필수 필드 검증
    ↓
자재 검증
    ↓
날짜 검증
    ↓
발주 등록 처리
    ↓
발주 번호 자동 생성
    ↓
상태: "출고대기" 설정
    ↓
성공 알림
    ↓
발주 목록 탭 전환
    ↓
목록 갱신
```

---

## 19. 개발 체크리스트

### 19.1 필수 구현 사항

**탭 1: 발주 목록**
- [ ] 발주 목록 조회 (페이징)
- [ ] 검색 (발주번호/견적명)
- [ ] 다중 필터 (상태/견적)
- [ ] 진행률 표시
- [ ] 발주 상세 모달

**탭 2: 발주 등록**
- [ ] 견적 Autocomplete 검색
- [ ] 자재 Autocomplete 검색
- [ ] 자재 드래그 앤 드롭 순서 변경
- [ ] 발주 요약 자동 계산
- [ ] 발주 등록

---

### 19.2 유효성 검증
- [ ] 필수 필드 검증
- [ ] 자재 1개 이상 검증
- [ ] 수량 1 이상 검증
- [ ] 납기일 ≥ 발주일 검증

---

### 19.3 사용자 경험
- [ ] 탭 전환 부드럽게
- [ ] Autocomplete 반응 빠르게
- [ ] 드래그 앤 드롭 직관적으로
- [ ] 실시간 요약 갱신
- [ ] 성공/실패 알림 명확히

---

### 19.4 비즈니스 로직
- [ ] 발주 번호 자동 생성
- [ ] 진행률 자동 계산
- [ ] 상태 자동 변경
- [ ] 견적 연동

---

## 20. 주의사항

### 20.1 반드시 지켜야 할 사항
1. **견적 기반 발주** ⭐⭐⭐
   - 모든 발주는 견적 기반
   - 견적 없는 발주 불가
   
2. **진행률 정확성**
   - 출고 데이터 기반 실시간 계산
   
3. **날짜 논리성**
   - 납기일 ≥ 발주일
   
4. **자재 필수**
   - 최소 1개 이상 자재 필요

---

### 20.2 사용자 경험 개선
1. Autocomplete 검색 빠르게
2. 드래그 앤 드롭 직관적으로
3. 실시간 요약 갱신
4. 에러 메시지 명확히

---

### 20.3 데이터 일관성
1. 발주 수량과 출고 수량 일치 확인
2. 진행률과 출고 현황 일치
3. 견적과 발주 연결 정확히

---

## 21. 참고 사항

### 21.1 향후 개선 사항
- 발주서 자동 생성 (PDF)
- Excel 업로드로 일괄 등록
- 발주 복사 기능
- 발주 수정 기능
- 발주 취소 기능

---

### 21.2 관련 화면
- 견적 관리: 발주 기반 데이터
- 출고 관리: 진행률 연동
- 입고 관리: 구매 발주 연동
- 현장 통합 현황: 발주 현황 조회

---

**작성일:** 2026-02-11  
**작성자:** 기획팀  
**버전:** 1.0 (비즈니스 로직 중심)
