# 견적 관리 [완]

### 1. 견적 관리

![image.png](image.png)

## 1. 화면 개요

### 1.1 기본 정보

- **화면명**: 견적 관리
- **목적**: 견적 목록 조회/검색, 견적 상세 확인, 견적 등록/수정, 상태 변경

---

## 2. 초기 로드

### 2.1 초기 데이터 로드

- 전체 견적 목록 조회
- 최신순 정렬
- 페이징: 50건씩 - TODO 논의 필요

### 2.2 초기 화면 상태

- 상태 필터: "상태 전체" 선택
- 검색어: 비어있음
- 요약 영역: 각 상태별 건수 표시
    - 전체 / 견적 / 수주 / 발주/ 완료

---

## 3. 검색/필터 영역

### 3.1 상태 필터

**필터 옵션:**

- 상태 전체 (기본값) / 견적 / 수주 / 발주/ 완료

---

### 3.2 검색 기능

**검색 대상:**

- 견적명 / 본사명 / 현장명
- 통합 검색 (OR 조건)

**검색 결과:**

- 매칭된 견적만 표시
- 결과 없으면: "검색 결과가 없습니다" 메시지 테이블에 표시

---

### 3.3 초기화 기능

**[초기화] 버튼 클릭 시:**

- 검색 입력 필드 초기화
- 상태 필터 "상태 전체"로 리셋
- 전체 목록 재조회

---

## 4. 요약 영역

### 4.1 통계 표시

```
전체: 45건 | 견적: 8건 | 수주: 15건 | 발주: 19건 | 완료: 3건
```

**특징:**

- 실시간 업데이트 (등록/수정/삭제 시)

---

### 4.2 [+ 새 견적 등록] 버튼

**위치:** 요약 영역 우측

**클릭 시:**

- 견적 등록 모달 오픈
- 폼 필드 초기화

---

## 5. 목록 테이블

### 5.1 컬럼 구조

| 컬럼명 | 표시 내용 | 비고 |
| --- | --- | --- |
| 견적 번호 | QT260110-01 | 굵게 표시 |
| 견적명 | 강남 오피스텔 CCTV 설치 |  |
| 본사 | 대우건설 |  |
| 현장 | 강남 오피스텔 |  |
| 금액 | 150M | 백만원 단위 |
| 진행률 | 프로그레스바 + 80% | 시각화 |
| 상태 | 뱃지 (발주) | 색상 구분 |
| 작업 | [상태변경] 버튼 |  |

---

### 5.2 행 클릭

**트리거:** 테이블 행 클릭

**동작:**

- 해당 견적의 상세 모달 오픈
- 견적 상세 정보 로드

**예외:**

- "작업" 컬럼의 버튼 클릭 시에는 행 클릭 무시
- 버튼만 동작

---

### 5.3 진행률 표시

**표시 방식:**

- 프로그레스 바 + 퍼센트 텍스트

**색상 규칙:**

| 진행률 | 색상 | 의미 |
| --- | --- | --- |
| 0-30% | 빨간색 | 지연 |
| 31-60% | 주황색 | 주의 |
| 61-100% | 초록색 | 정상 |

---

### 5.4 상태 뱃지

**상태별 표시:**

| 상태 | 텍스트 | 색상 |
| --- | --- | --- |
| 견적 | 견적 | 노란색 |
| 수주 | 수주 | 파란색 |
| 진행중 | 진행중 | 초록색 |
| 완료 | 완료 | 회색 |

---

## 6. 견적 상세 모달

### 6.1 오픈 조건

- 테이블 행 클릭
- [상세] 버튼 클릭 (있을 경우)

---

### 6.2 탭 구성

### **탭 1: 기본 정보**

**표시 항목:**

- 견적 기본 정보
    - 견적 번호
    - 견적명
    - 견적 유형
    - 본사
    - 현장
    - 소유 구분 (판매/임대/바이백)
    - 품질 구분 (신품/중고)
    - 현장 유형 (신규/이전설치/유지보수)
    - 담당자
    - 견적일
    - 견적 금액
    - 비고
    - 상태
- 진행 현황
    - 진행률 (%)
    - 자재 출고 현황 (출고율)
- 상태 이력
    - 변경일시, 변경 전 상태, 변경 후 상태, 변경자, 비고

**버튼:**

- [수정]: 견적 수정 모달 오픈
- [닫기]: 모달 닫기

---

### **탭 2: 자재 진행 현황**

**표시 정보:**

- 견적에 포함된 자재별 출고 현황

**컬럼:**

| 자재코드 | 자재명 | 견적수량 | 출고수량 | 잔여수량 | 진행률 | 상태 |
| --- | --- | --- | --- | --- | --- | --- |

**상태 표시:**

- 진행중: 출고 진행 중
- 완료: 전량 출고 완료
- 지연: 예정일 초과

---

### **탭 3: 출고 이력**

**표시 정보:**

- 견적에 대한 출고 건별 이력
- 출고일, 출고 수량, 담당자
- 각 출고 건의 세부 자재 목록

**정렬:**

- 최신순

---

### 6.3 [닫기] 버튼

**동작:**

- 모달 닫기
- 입력 내용 유지 안 함

---

### 6.4 [수정] 버튼

**표시 위치:**

- 기본 정보 탭에서만 표시

**동작:**

- 현재 견적 정보를 수정 폼에 로드
- 견적 수정 모달 오픈
- 상세 모달은 유지 또는 닫기 (UX 결정 필요)

---

## 7. 상태 변경 모달

### 7.1 모달 오픈

**트리거:**

- 목록의 [상태변경] 버튼 클릭

**표시 정보:**

- 대상 견적 번호
- 현재 상태 (읽기 전용)

---

### 7.2 입력 필드

**변경할 상태:** (라디오 버튼)

- 견적 / 수주 / 발주 / 완료

**기본 선택:**

- 현재 상태로 체크됨

**수정 사유:**

- 상태 변경 사유 입력
- 최대 500자

---

### 7.3 [저장] 버튼

**유효성 검증:**

1. 변경할 상태 선택 확인
    - 미선택 시: "변경 상태를 선택해주세요" 알림
2. 비고는 선택사항 (검증 안 함)

**동작 순서:**

1. 상태 선택 검증
2. 상태 변경 처리
3. 목록 테이블의 상태 뱃지 즉시 갱신
4. 성공 알림 표시
    - "상태가 변경되었습니다"
    - 견적번호, 변경 상태 표시
    - 비고 입력 시 함께 표시
5. 모달 닫기

**목록 갱신:**

- 해당 행의 상태 뱃지만 업데이트
- 전체 목록 재조회 불필요

---

### 7.4 [취소] 버튼

**동작:**

- 모달 닫기
- 변경사항 없음

---

## 8. 견적 수정 모달

### 8.1 모달 오픈

**트리거:**

- 견적 상세 모달의 [수정] 버튼 클릭

**초기 데이터:**

- 기존 견적 정보를 폼에 자동 입력
- 수정 사유 필드는 항상 비어있음

---

### 8.2 입력 필드

**필수 입력 (*):**

- 견적명*
- 본사*
- 현장*
- 현장 유형* (신규/증설/교체)
- 견적일*
- **수정 사유**⭐ (견적 수정 시에만 필수!)
- 견적서 파일 (이미지/PDF)

**선택 입력:**

- 견적 유형
- 소유 구분 (판매/임대/바이백)
- 품질 구분 (신품/중고)
- 견적 금액
- 비고

---

### 8.3 [저장] 버튼

**유효성 검증:**

**1단계: 필수 필드 검증**

- 모든 필수 필드 입력 확인
- 미입력 시: toast 알림
- 해당 필드로 포커스 이동

**2단계: 수정 사유 검증** ⭐ **중요!**

- 수정 사유 입력 확인
- 비어있으면: "수정 사유를 입력해주세요" 알림
- 포커스 이동

**동작 순서:**

1. 필수 필드 검증
2. 수정 사유 검증 (필수!)
3. 수정 처리
4. 성공 알림: "견적 정보가 수정되었습니다"
5. 모달 닫기
6. 목록 갱신 (해당 행 업데이트)

**변경 이력 기록:**

- 수정 사유는 변경 이력에 저장
- 변경 전/후 값 기록
- 변경자, 변경일시 기록

---

### 8.4 [취소] 버튼

**동작:**

- 확인 메시지: "수정을 취소하시겠습니까?"
- 확인 시: 모달 닫기
- 취소 시: 모달 유지

---

## 9. 견적 등록 모달

### 9.1 모달 오픈

**트리거:**

- [+ 새 견적 등록] 버튼 클릭

**초기 상태:**

- 모든 필드 비어있음
- 견적일 기본값: 오늘 날짜

---

### 9.2 입력 필드

**필수 입력 (*):**

- 견적명*
- 본사*
- 현장*
- 현장 유형* (신규/증설/교체)
- 견적일*
- 견적서 파일*

**선택 입력:**

- 견적 유형
- 소유 구분 (판매/임대/바이백)
- 품질 구분 (신품/중고)
- 견적 금액
- 비고

**주의:**

- 견적 등록 시에는 "수정 사유" 필드 없음
- 수정 시에만 필요

---

### 9.3 [등록] 버튼

**유효성 검증:**

- 필수 필드 입력 확인
- 미입력 시: toast 알림
- 해당 필드로 포커스 이동

**동작 순서:**

1. 필수 필드 검증
2. 견적 등록 처리
3. 견적 번호 자동 생성
    - 형식: IT + YYMMDD + - + 일련번호 TODO 확인필요
    - 예: IT260211-01
4. 초기 상태: "견적"으로 설정
5. 성공 알림: "견적이 등록되었습니다"
6. 모달 닫기
7. 목록 갱신 (새 견적 최상단 추가)
8. 요약 영역 건수 업데이트

---

### 9.4 [취소] 버튼

**동작:**

- 확인 메시지: "등록을 취소하시겠습니까?"
- 확인 시: 모달 닫기
- 취소 시: 모달 유지

---

## 10. 유효성 검증 규칙

### 10.1 견적 등록 필수 필드

- 견적명
- 견적 유형
- 본사
- 현장
- 소유 구분
- 품질 구분
- 현장 유형
- 견적일
- 견적 금액

**검증 방식:**

- 커스텀 Input 보더 속성 활용
- toast 메시지 표시

---

### 10.2 견적 수정 추가 검증 ⭐

**견적 수정 시 추가 필수:**

- 수정 사유 (필수!)

**검증:**

- 필수 필드 검증 후
- 수정 사유 입력 확인
- 비어있으면: "수정 사유를 입력해주세요"
- 포커스 이동

**중요:**

- 견적 등록과 견적 수정의 차이점!
- 수정 시에만 수정 사유 필수 검증

---

### 10.3 상태 변경 검증

- 변경할 상태 선택 확인
- 미선택 시: "변경 상태를 선택해주세요"
- 비고는 선택사항

---

### 10.4 금액 검증

- 숫자만 입력 가능
- 0원 이상
- 최대 999,999,999,999원

---

### 10.5 날짜 검증

- 날짜 형식: YYYY-MM-DD
- 유효한 날짜인지 확인

---

## 11. 상태 정의 및 흐름

### 11.1 상태 종류

| 상태 코드 | 한글명 | 설명 | 상태 변경 주체 |
| --- | --- | --- | --- |
| quote | 견적 | 견적 작성 완료, 수주 대기 중 | 영업 담당자 |
| approved | 수주 | 계약 체결 완료, 발주 대기중 | 영업 담당자 |
| order | 발주 | 발주서 등록 완료, 출고 대기중 | 자재 담당자 |
| complete | 완료 | 프로젝트 완료, 검수 완료 | 영업 담당자 |

---

### 11.2 상태 흐름

**기본 흐름:**

```
견적 → 수주 → 발주 → 완료
```

**상태 변경 규칙:**

- 순차적 진행 권장
- 모든 상태에서 다른 모든 상태로 변경 가능

**권한:**

- 영업 담당자만 상태 변경 가능

---

### 11.3 상태별 의미

**견적 (quote):**

- 견적서 작성 완료
- 수주 대기 중

**수주 (approved):**

- 계약 체결
- 자재 발주 등록 대기 중

**발주 (order):**

- 자재 발주 등록

**완료 (complete):**

- 영업 담당자가 완료처리 한 상태

---

## 12. 파일 업로드

### 12.1 업로드 가능 파일

- 이미지: jpg, jpeg, png, gif
- 문서: pdf
- 최대 용량: 10MB/파일
- 최대 개수: 5개

---

### 12.2 미리보기

- 이미지 파일: 썸네일 표시 (80x80px)
- PDF 파일: 파일명 + 아이콘 표시

---

### 12.3 삭제

- 각 파일별 [×] 버튼 표시
- 클릭 시 즉시 삭제 (확인 없이)

---

## 13. 에러 처리

### 13.1 사용자 입력 오류

| 상황 | 메시지 | 동작 |
| --- | --- | --- |
| 필수 필드 누락 | "필수 항목을 입력해주세요." | 해당 필드 포커스 |
| 수정 사유 미입력 | "수정 사유를 입력해주세요." | 포커스 이동 |
| 상태 미선택 | "변경 상태를 선택해주세요." |  |
| 금액 형식 오류 | "올바른 금액을 입력해주세요." | 포커스 유지 |

---

### 13.2 파일 업로드 오류

| 상황 | 메시지 |
| --- | --- |
| 용량 초과 | "파일 크기는 10MB 이하여야 합니다." |
| 형식 오류 | "이미지 또는 PDF 파일만 업로드 가능합니다." |

---

## 14. 비즈니스 규칙

### 14.1 견적 번호 생성

- 자동 생성 (수동 입력 불가)
- 형식: IT + YYMMDD + - + 일련번호
- 예: IT260211-01 (2026년 2월 11일, 첫 번째)
- 일자별 순번 관리

---

### 14.2 진행률 계산

```
진행률 = (출고 완료 자재 수량 / 전체 견적 자재 수량) × 100
```

**자동 계산:**

- 자재 출고 시 자동 갱신
- 실시간 반영

---

### 14.3 상태 변경 규칙

**진행률에 따른 자동 상태 변경:**

- 진행률 100%: 자동으로 "완료"로 변경 (선택)

**발주 등록에 따른 자동 상태 변경:**

- 발주서 등록 시 “발주”로 변경

**수동 변경 우선:**

- 자동 변경은 참고용
- 수동 상태 변경이 우선

---

### 14.4 삭제 규칙

- 견적 상태일 때만 삭제 가능
- 수주 이후: 삭제 불가, 취소 처리만 가능
- 삭제 시 확인 메시지 필수

---

### 14.5 수정 이력 관리

- 모든 수정 시 수정 사유 필수 기록
- 변경 전/후 값 저장
- 변경자, 변경일시 자동 기록
- 수정 이력 조회 가능 (상세 모달에서)

---

### 14.6 알림 규칙 (선택)

**알림 대상:**

- 상태 변경 시: 담당 영업에게 알림
- 진행률 100% 도달 시: 담당자에게 알림
- 견적 등록 시: 자재부 팀원에게 알림

---

## 15. 주요 차이점 정리

### 15.1 견적 등록 vs 견적 수정

| 구분 | 견적 등록 | 견적 수정 |
| --- | --- | --- |
| **수정 사유** | ❌ 없음 | ✅ 필수 입력 |
| **검증** | 필수 필드만 | 필수 필드 + 수정 사유 |
| **견적 번호** | 자동 생성 | 변경 불가 |
| **초기 상태** | "견적"으로 고정 | 변경 불가 |
| **성공 메시지** | "견적이 등록되었습니다" | "견적 정보가 수정되었습니다" |

**핵심 차이:**

- 견적 수정 시에만 "수정 사유" 필드가 필수!
- 이력 관리를 위해 반드시 입력 받아야 함

---

## 16. 화면 흐름도

### 16.1 견적 등록 흐름

```
[+ 새 견적 등록] 클릭
    ↓
견적 등록 모달 오픈
    ↓
필수 정보 입력
    ↓
[등록] 클릭
    ↓
필수 필드 검증
    ↓
견적 등록 처리
    ↓
견적 번호 자동 생성
    ↓
상태: "견적" 설정
    ↓
성공 알림
    ↓
목록 갱신
```

---

### 16.2 견적 수정 흐름

```
목록 행 클릭
    ↓
견적 상세 모달 오픈
    ↓
[수정] 버튼 클릭
    ↓
견적 수정 모달 오픈
    ↓
정보 수정 + 수정 사유 입력 ⭐
    ↓
[저장] 클릭
    ↓
필수 필드 검증
    ↓
수정 사유 검증 ⭐ (필수!)
    ↓
수정 처리 + 이력 기록
    ↓
성공 알림
    ↓
목록 갱신
```

---

### 16.3 상태 변경 흐름

```
[상태변경] 버튼 클릭
    ↓
상태 변경 모달 오픈
    ↓
현재 상태 표시 (읽기 전용)
    ↓
변경할 상태 선택
    ↓
비고 입력 (선택)
    ↓
[저장] 클릭
    ↓
상태 선택 검증
    ↓
상태 변경 처리
    ↓
목록 뱃지 즉시 갱신
    ↓
성공 알림
```

---

## 17. 개발 체크리스트

### 17.1 필수 구현 사항

- [ ]  견적 목록 조회 (페이징)
- [ ]  검색 (견적/본사/현장명 통합)
- [ ]  상태 필터
- [ ]  견적 등록
- [ ]  견적 수정 (수정 사유 필수!)
- [ ]  견적 상세 조회 (탭 3개)
- [ ]  상태 변경 (비고 선택)
- [ ]  파일 업로드/미리보기/삭제

---

### 17.2 유효성 검증

- [ ]  검색어 입력 검증
- [ ]  필수 필드 검증 (등록/수정)
- [ ]  수정 사유 필수 검증 (수정 시만!)
- [ ]  상태 선택 검증
- [ ]  금액 형식 검증
- [ ]  파일 검증 (형식/크기/개수)

---

### 17.3 사용자 경험

- [ ]  검색/필터 즉시 반영
- [ ]  성공/실패 알림 명확히
- [ ]  포커스 관리 (오류 필드로 이동)
- [ ]  로딩 인디케이터 표시
- [ ]  모달 배경 클릭 시 닫기
- [ ]  행 클릭 vs 버튼 클릭 구분

---

### 17.4 비즈니스 로직

- [ ]  견적 번호 자동 생성
- [ ]  진행률 자동 계산
- [ ]  상태별 색상 구분
- [ ]  수정 이력 기록 (수정 사유 포함)
- [ ]  상태 변경 이력 기록 (비고 포함)

---

## 18. 주의사항

### 18.1 반드시 지켜야 할 사항

1. **견적 수정 시 수정 사유 필수 검증** ⭐⭐⭐
    - 가장 중요한 비즈니스 규칙
    - 이력 관리를 위해 반드시 필요
2. **상태 변경 시 목록 즉시 갱신**
    - 전체 새로고침 아님
    - 해당 행만 업데이트
3. **진행률 계산 정확성**
    - 출고 데이터 기반 실시간 계산
4. **견적 번호 중복 방지**
    - 일자별 순번 관리 필수

---

### 18.2 사용자 경험 개선

1. 검색/필터 결과 즉시 반영
2. 에러 메시지 명확하고 친절하게
3. 필수 필드 표시 명확히 (*)
4. 로딩 상태 표시
5. 성공/실패 알림 일관성 있게

---

### 18.3 데이터 일관성

1. 견적 금액과 자재 금액 합계 일치
2. 진행률과 출고 현황 일치
3. 상태와 진행률 논리적 일치
4. 수정 이력 누락 없이 기록

---

## 19. 참고 사항

### 19.1 향후 개선 사항

- 견적서 자동 생성 기능
- Excel 업로드
- 견적 복사 기능
- 견적 비교 기능
- 대시보드 연동 (통계/차트)

---

### 19.2 관련 화면

- 발주 관리: 수주 → 발주 전환
- 자재 관리: 견적 자재 확인
- 출고 관리: 진행률 연동
- 현장 통합 현황: 견적 현황 조회

---

---